# JavaEEアプリケーション開発

## アプリケーションの形態
- CUI／GUI
- デスクトップ／Web
- モバイル

## Webアプリケーション
- Webサイトとの違い
    - HTMLの動的生成
    - ブラウザ（ユーザ操作）からのデータ入力
- CGIとその後に現れてきたもの
    - Webサーバ
    - APサーバ

## JavaEE
- Webアプリケーションの開発を支援するAPI仕様
    - HTTP処理
    - DBアクセス
    - 性能面の工夫
    - などなど
- こういうAPIを提供する「フレームワーク」があれば、Web開発が楽だよね！
    - あくまでAPI仕様（決まりごと）であってプログラム本体ではない
- ちなみにJava業界で色々あってJakartaEEという名前に変わる（変わった？）

## Wildfly
- JavaEE仕様に準拠したAPサーバ
    - JavaEE APIを使ったアプリケーションを載せて動かせる環境
- オープンソース
    - Wildflyをテストしまくって品質あげた有料版がJBossEAP
    - Wildflyの旧称はJBossAS
        - 「JBoss」という言葉がいろいろなものに使われるので改称した
- Wildfly以外にもJavaEE準拠のAPサーバ製品は色々ある
    - 製品によっては一部の機能しか提供しないものも

# とりあえず作ってみる

## 準備
- Wildfly
- Eclipseでサンプルアプリ

## [課題] apricotをWeb化
- bananaプロジェクトをEclipseにImport
    1. File > Import
    2. Gradle > Existing Gradle Project > Next
    3. Next
    4. [Project root directory]: projects\bananaを指定 > Finish
- DB・データソース設定
    - BANANA
        - SAMPLE_DATAテーブル作成
    - Wildflyデータソース設定
- 動かし方
    1. プロジェクトエクスプローラから banana.web 右クリック > Run As > Run on Server

- まずはサンプルコードを基にapricot移植
    - DB I/O (JPA)
        - 就業時間帯マスタをDBに格納、コード指定できるように
    - Web API
        - Postmanの使い方を覚える
        - [RESTサービスを触る際の必須ツールPostmanを使ってみました](https://www.xlsoft.com/jp/blog/blog/2017/06/23/post-1638/)
        - サンプルのWebAPI
            - [GET] http://localhost:8080/banana.web/webapi/sample/read/test
            - [POST] http://localhost:8080/banana.web/webapi/sample/write
                - Body: { "name": "a", "value": 30 }
    - apricot移植課題の仕様
        - パラメータを指定してapricot.consoleと同じ内容のJSONを返すWebAPIを１つ作る
        - パラメータ
            - 就業時間帯マスタのコード
            - 開始・終了時刻
            

## Webアプリケーションの裏側
- デプロイ
    - Deployment Scanner
    - dataディレクトリ
- DIコンテナ
    - DI (Dependency Injection, 依存注入・依存性の注入)
    - インスタンスを効率的に管理してくれる
    - ライフサイクル
- O/Rマッパー
    - Object-Relational mapper
    - インピーダンスミスマッチの緩和
    - この裏には更にJDBCがいる
    - DB/SQLが分からなくてもOK、ではない！
- HTTP
    - Request
        - Header
        - Body
    - Response
        - Header
        - Body


## [課題] UIの作り方
projects\banana\banana.web\src\main\webapp

↑このフォルダ以下に配置したファイルは、ブラウザに公開されます。

projects\banana\banana.web\src\main\webapp\test.html

に対して、↓のURLが対応します。

http://localhost:8080/banana.web/test.html

【ファイルの作成】

Eclipseのプロジェクトエクスプローラ上で、webappフォルダを右クリック→New→HTML File　などで作成できます。

【外部入手ファイルの配置】

jQueryは公式サイトからダウンロードしてきて配置する必要があります。が、私の知識の範囲だと、Eclipse上からの操作だけではできません。

1. Windowsのエクスプローラ上で、webapp内にファイルを配置する
2. Eclipseのプロジェクトエクスプローラ上で、webappを選択してF5（Refresh）

これでEclipseがファイルを認識してくれて、自動的にアプリケーションに含めてくれます。


なお、アプリケーションをRun/Debugしている状態でも、ファイルの変更は自動的にWildfly上に反映されます。「ホットスワップ」と呼ばれる仕組みです。

ただし制限があって、Javaのクラスやメソッドの追加のような大きめの修正をした場合は、一度Wildflyを再起動する必要があります。Continue（無視して起動しっぱ）とかTerminate（停止）とかのボタンがあるエラーダイアログが開くはず。

webapp内の変更に対してはほぼ問題無くホットスワップが使えます。

### 課題内容

- 簡単な入力・結果表示画面
    - 就業時間帯マスタを選択
    - 出勤時刻、退勤時刻を入力
    - 計算ボタン
    - 結果を表示
- JavaScriptで入力補完、バリデーション
    - jQuery使おう
    - 時刻の入力形式
        - "h:mm" -> OK
        - "hmm" -> "h:mm"に変換
        - 時刻として不正な入力はエラーに
            - "3:78" とか
            - 受付可能な時刻の範囲は "0:00"～"47:59" とする
            - エラーになったらエラーメッセージの表示（形式は自由）と、入力欄の枠を赤くする
        - 変換やエラーチェックは、サーバに送る直前でもOK
        - テキストボックスからフォーカスが外れた瞬間でもOK
    - 出勤・退勤の逆転

## [課題] 就業時間帯マスタのメンテ画面
- 使いやすそうなUIを作ってみよう
- 今はまだjQueryだけで


# 少しレベルアップ？

- ユニットテスト
    - アプリケーションを起動・操作してコードのテスト
        - 単純に時間がかかる
    - テストコードの方が起動も実行もずっと速い
    - テストが書きやすいコードを書こう
        - 良いコード（読みやすくメンテしやすいコード）はテストもしやすい
- Stream API
    - ラムダ式
    - 宣言的であるということ
- インタフェースの使い方
    - インタフェースは「決めごと」
    - クラス間の依存を弱め、互いの修正を楽にする
- デザインパターン
    - 昔の偉い人達が色々考えた「色んな場面で使い回せる設計のパターン」
    - 便利なものの多くはライブラリ・フレームワークが実装済み、自分で使うことは少ない
    - 自分で使うことが結構あるもの：
        - Factory Method
        - Builder
        - Strategy/State
        - Decorator
- DIコンテナ再び
    - インタフェースだけ指定
    - テスタビリティ（テストしやすさ）への寄与
- HTTP再び
    - 同期／非同期
    - Cookie
        - セッション
    - REST
    - SSL/TLS
        - 公開鍵暗号
        - 暗号化とサーバ証明

## [課題] スケジュール作成